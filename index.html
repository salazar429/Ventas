<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Facturaci√≥n Vendedoras</title>
    <meta name="description" content="Sistema de facturaci√≥n PWA para vendedoras">
    <meta name="theme-color" content="#2c3e50">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Iconos para Apple -->
    <link rel="apple-touch-icon" href="icons/icon-192.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <!-- Hojas de estilo -->
    <link rel="stylesheet" href="styles.css">
    
    <style>
        /* ===== SPLASH SCREEN ===== */
        .splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: linear-gradient(135deg, var(--primary-color), var(--dark-color));
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            transition: opacity 0.5s ease, visibility 0.5s ease;
            color: white;
            text-align: center;
            padding: 20px;
        }
        
        .splash-screen.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }
        
        .splash-icon {
            font-size: 6rem;
            margin-bottom: 1rem;
            animation: pulse 2s infinite;
        }
        
        .splash-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            letter-spacing: 2px;
        }
        
        .splash-subtitle {
            font-size: 1rem;
            opacity: 0.9;
            margin-bottom: 2rem;
        }
        
        .splash-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* ===== LOGIN SECTION ===== */
        .login-section {
            max-width: 450px;
            margin: 30px auto;
            padding: 0 15px;
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.5s ease, transform 0.5s ease;
        }
        
        .login-section.visible {
            opacity: 1;
            transform: translateY(0);
        }
        
        .login-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 2rem;
            box-shadow: var(--box-shadow);
        }
        
        .login-header {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .login-header .logo-icon {
            font-size: 3rem;
            color: var(--secondary-color);
        }
        
        .login-header h1 {
            color: var(--primary-color);
            font-size: 1.5rem;
            margin-top: 0.5rem;
        }
        
        .test-credentials {
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid #eee;
            font-size: 0.85rem;
            color: #666;
        }
        
        .hidden {
            display: none !important;
        }
        
        /* ===== ESTADO DEL SERVIDOR ===== */
        .connection-status {
            position: fixed;
            top: 70px;
            right: 15px;
            padding: 0.5rem 1rem;
            border-radius: var(--border-radius);
            font-size: 0.8rem;
            font-weight: 600;
            z-index: 150;
            box-shadow: var(--box-shadow);
        }
        
        .connection-status.online {
            background: var(--accent-color);
            color: white;
        }
        
        .connection-status.offline {
            background: var(--danger-color);
            color: white;
        }
        
        .page-section {
            display: none;
        }
        
        .page-section.active {
            display: block;
        }
        
        .avatar {
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .avatar:hover {
            transform: scale(1.1);
        }
        
        .logout-btn {
            background: var(--danger-color);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            padding: 0.4rem 0.8rem;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            margin-left: 0.8rem;
            transition: var(--transition);
        }
        
        .logout-btn:hover {
            background: #c0392b;
        }
        
        .floating-badge {
            background-color: var(--danger-color);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: bold;
            margin-left: 0.2rem;
        }
        
        .user-info {
            display: flex;
            align-items: center;
        }
    </style>
</head>
<body>
    <!-- ===== SPLASH SCREEN ===== -->
    <div id="splashScreen" class="splash-screen">
        <div class="splash-icon">üëó</div>
        <div class="splash-title">Facturaci√≥n</div>
        <div class="splash-subtitle">Sistema para Vendedoras</div>
        <div class="splash-spinner"></div>
    </div>

    <!-- ===== ESTADO DEL SERVIDOR (oculto hasta despu√©s del splash) ===== -->
    <div id="serverStatus" class="connection-status online" style="display: none;">
        üîç Verificando conexi√≥n...
    </div>

    <!-- ===== PANEL DE LOGIN ===== -->
    <div id="loginPanel" class="login-section">
        <div class="login-header">
            <div class="logo-icon">üëó</div>
            <h1>Sistema de Facturaci√≥n</h1>
            <p style="color: #666; margin-top: 0.5rem;">Inicia sesi√≥n para continuar</p>
        </div>
        
        <div class="login-card">
            <div id="loginError" style="background: #f8d7da; color: #721c24; padding: 0.8rem; border-radius: var(--border-radius); margin-bottom: 1.5rem; display: none;"></div>
            
            <div class="form-group">
                <label>Usuario</label>
                <input type="text" id="usuario" class="form-control" placeholder="Ej: maria_g" value="maria_g">
            </div>
            
            <div class="form-group">
                <label>Contrase√±a</label>
                <input type="password" id="password" class="form-control" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" value="123456">
            </div>
            
            <button id="btnLogin" class="btn btn-primary" style="width: 100%; padding: 0.8rem; font-size: 1rem;">
                üîë Iniciar Sesi√≥n
            </button>
            
            <div class="test-credentials">
                <strong>Credenciales de prueba:</strong><br>
                maria_g / 123456<br>
                ana_r / 123456<br>
                <span style="color: var(--primary-color);">¬°Y cualquier vendedora que crees desde Due√±o!</span>
            </div>
        </div>
    </div>

    <!-- ===== PANEL DE VENTA (oculto hasta login) ===== -->
    <div id="ventaPanel" style="display: none;">
        <header>
           <div class="header-container">
             <div class="logo">
                <span>üìä</span>
                   <h1>Facturaci√≥n</h1>
            </div>
           <div class="user-info">
             <span id="userName">Vendedora</span>
             <div class="avatar" id="userAvatar" title="Perfil">V</div>
             <button id="logoutBtn" class="logout-btn">
                üö™ Salir
             </button>
            <!-- PUNTO DE ESTADO DE CONEXI√ìN -->
            <div id="connectionDot" class="connection-dot online" title="Conectado"></div>
        </div>
    </div>
</header>


        <!-- Barra de b√∫squeda -->
        <div class="search-container">
            <div class="search-box">
                <input type="text" id="searchInput" class="search-input" placeholder="Buscar productos...">
                <button id="searchBtn" class="search-btn">üîç</button>
            </div>
            <div class="category-filter" id="categoryFilterContainer">
                <button class="category-btn active" data-category="todos">Todos</button>
                <button class="category-btn" data-category="ropa">Ropa</button>
                <button class="category-btn" data-category="calzado">Calzado</button>
                <button class="category-btn" data-category="accesorios">Accesorios</button>
                <button class="category-btn" data-category="electr√≥nica">Electr√≥nica</button>
                <button class="category-btn" data-category="hogar">Hogar</button>
            </div>
        </div>

        <!-- Bot√≥n flotante -->
        <button id="floatingSaleBtn" class="floating-sale-btn">
            <span class="floating-icon">üõí</span>
            <span class="floating-text">Venta Actual</span>
            <span class="floating-badge" id="cartBadge">0</span>
        </button>

        <!-- Panel de venta actual -->
        <div id="currentSalePanel" class="current-sale-panel">
            <div class="sale-panel-header">
                <h3>
                    Venta Actual
                    <span id="saleItemsCount">(0 productos)</span>
                </h3>
                <button id="closeSaleBtn" class="close-panel-btn">&times;</button>
            </div>
            <div class="sale-panel-content">
                <div class="sale-items-container">
                    <div class="sale-header">
                        <div>Producto</div>
                        <div>Precio</div>
                        <div>Cantidad</div>
                        <div>Subtotal</div>
                        <div></div>
                    </div>
                    <div id="saleItemsContainer">
                        <div class="empty-message">No hay productos en la venta actual</div>
                    </div>
                </div>
                <div class="sale-panel-summary">
                    <div class="summary-row">
                        <span>Subtotal:</span>
                        <span id="subtotal">$0.00</span>
                    </div>
                    <div class="summary-row summary-total">
                        <span>Total:</span>
                        <span id="total">$0.00</span>
                    </div>
                    <input type="text" id="clientName" class="client-input" placeholder="Cliente (opcional)">
                    <div class="sale-panel-buttons">
                        <button id="completeSaleBtn" class="btn btn-primary">üíµ Completar Venta</button>
                        <button id="clearSaleBtn" class="btn btn-danger">üóëÔ∏è Cancelar</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Contenido principal -->
        <main>
            <!-- SECCI√ìN DASHBOARD -->
            <div id="dashboardSection" class="page-section active">
                <div class="dashboard-cards">
                    <div class="card">
                        <div class="card-icon">üí∞</div>
                        <h3>Ventas Hoy</h3>
                        <div class="card-value" id="ventasHoyCount">0</div>
                    </div>
                    <div class="card">
                        <div class="card-icon">üì¶</div>
                        <h3>Productos</h3>
                        <div class="card-value" id="totalProductosCount">0</div>
                    </div>
                    <div class="card">
                        <div class="card-icon">‚è≥</div>
                        <h3>Pendiente</h3>
                        <div class="card-value" id="pendienteCount">0</div>
                    </div>
                    <div class="card" id="ventaActualCard">
                        <div class="card-icon">üõí</div>
                        <h3>Carrito</h3>
                        <div class="card-value" id="carritoCount">0</div>
                    </div>
                </div>

                <!-- Productos disponibles -->
                <h2 class="section-title">
                    Productos Disponibles
                    <span id="productCount">(0 productos)</span>
                </h2>
                
                <div id="productoContainer" class="products-grid"></div>

                <!-- Ventas recientes -->
                <h2 class="section-title">Ventas Recientes</h2>
                <div class="sales-history">
                    <div class="history-header">
                        <div>Cliente / Fecha</div>
                        <div>Productos</div>
                        <div>Total</div>
                        <div>Estado</div>
                    </div>
                    <div id="ventasRecientesContainer">
                        <div class="empty-message" style="padding: 1.5rem;">No hay ventas registradas a√∫n</div>
                    </div>
                </div>
            </div>

            <!-- SECCI√ìN VENTAS -->
            <div id="salesSection" class="page-section">
                <h2 class="section-title">Todas las Ventas</h2>
                <div class="sales-history full">
                    <div class="history-header">
                        <div>Cliente / Fecha</div>
                        <div>Productos</div>
                        <div>Total</div>
                        <div>Estado</div>
                    </div>
                    <div id="allSalesContainer">
                        <div class="empty-message">No hay ventas registradas</div>
                    </div>
                </div>
                
                <div class="stats-container">
                    <h3 class="section-title">Estad√≠sticas de Ventas</h3>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="totalSalesAmount">$0.00</div>
                            <div class="stat-label">Total Ventas</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="avgSaleAmount">$0.00</div>
                            <div class="stat-label">Promedio por Venta</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="totalSalesCount">0</div>
                            <div class="stat-label">Ventas Totales</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SECCI√ìN INVENTARIO -->
            <div id="productsSection" class="page-section">
                <h2 class="section-title">Gesti√≥n de Inventario</h2>
                
                <div class="inventory-stats">
                    <div class="inventory-stat">
                        <div class="stat-value" id="inventoryTotalProducts">0</div>
                        <div class="stat-label">Productos Totales</div>
                    </div>
                    <div class="inventory-stat warning">
                        <div class="stat-value" id="lowStockCount">0</div>
                        <div class="stat-label">Stock Bajo</div>
                    </div>
                    <div class="inventory-stat danger">
                        <div class="stat-value" id="outOfStockCount">0</div>
                        <div class="stat-label">Agotados</div>
                    </div>
                </div>
                
                <div class="inventory-actions">
                    <button class="btn btn-secondary" id="exportInventoryBtn">üì§ Exportar Inventario</button>
                    <button class="btn btn-primary" id="refreshInventoryBtn">üîÑ Actualizar</button>
                </div>
                
                <h3 class="section-title">Lista de Productos</h3>
                <div class="inventory-table-container">
                    <table class="inventory-table">
                        <thead>
                            <tr>
                                <th>Producto</th>
                                <th>Categor√≠a</th>
                                <th>Precio</th>
                                <th>Stock</th>
                                <th>Estado</th>
                            </tr>
                        </thead>
                        <tbody id="inventoryTableBody">
                            <tr>
                                <td colspan="5" style="text-align: center; padding: 2rem; color: #7f8c8d;">
                                    Cargando inventario...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- SECCI√ìN REPORTES -->
            <div id="reportsSection" class="page-section">
                <h2 class="section-title">Reportes</h2>
                
                <div class="reports-header">
                    <div class="date-selector">
                        <label for="reportDate">Fecha:</label>
                        <input type="date" id="reportDate" class="form-control" value="">
                    </div>
                    <button class="btn btn-primary" id="generateReportBtn">üìä Generar Reporte</button>
                </div>
                
                <div class="reports-grid">
                    <div class="report-card">
                        <h3>üìä Ventas del D√≠a</h3>
                        <div class="report-content">
                            <div class="report-stat">
                                <span>Total:</span>
                                <span id="dailyTotal">$0.00</span>
                            </div>
                            <div class="report-stat">
                                <span>Ventas:</span>
                                <span id="dailySalesCount">0</span>
                            </div>
                            <div class="report-stat">
                                <span>Promedio:</span>
                                <span id="dailyAvg">$0.00</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="report-card">
                        <h3>üè∑Ô∏è Ventas por Categor√≠a</h3>
                        <div class="report-content" id="categorySales">
                            <div class="empty-message">Selecciona una fecha</div>
                        </div>
                    </div>
                    
                    <div class="report-card">
                        <h3>üìà Tendencias</h3>
                        <div class="report-content">
                            <div class="trend-item">
                                <span>Mejor Producto:</span>
                                <span id="bestProduct">-</span>
                            </div>
                            <div class="trend-item">
                                <span>Mejor Hora:</span>
                                <span id="bestHour">-</span>
                            </div>
                            <div class="trend-item">
                                <span>Categor√≠a Top:</span>
                                <span id="topCategory">-</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="export-section">
                    <h3 class="section-title">Exportar Reportes</h3>
                    <div class="export-buttons">
                        <button class="btn btn-secondary" id="exportPDFBtn">üìÑ PDF</button>
                        <button class="btn btn-secondary" id="exportExcelBtn">üìä Excel</button>
                    </div>
                </div>
            </div>
        </main>

        <!-- Men√∫ inferior -->
        <nav class="bottom-nav">
            <a href="#" class="nav-item active" data-page="dashboard">
                <span class="nav-icon">üè†</span>
                <span class="nav-label">Inicio</span>
            </a>
            <a href="#" class="nav-item" data-page="sales">
                <span class="nav-icon">üí∞</span>
                <span class="nav-label">Ventas</span>
            </a>
            <a href="#" class="nav-item" data-page="products">
                <span class="nav-icon">üì¶</span>
                <span class="nav-label">Inventario</span>
            </a>
            <a href="#" class="nav-item" data-page="reports">
                <span class="nav-icon">üìä</span>
                <span class="nav-label">Reportes</span>
            </a>
        </nav>
    </div>

    <!-- Notificaci√≥n -->
    <div id="notification" class="notification" style="display: none;"></div>

    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js')
                    .then(registration => {
                        console.log('‚úÖ ServiceWorker registrado');
                    })
                    .catch(error => {
                        console.log('‚ùå Error al registrar ServiceWorker:', error);
                    });
            });
        }
    </script>

    <!-- App JS -->
    <script src="app_vendedora.js"></script>
</body>
</html>
